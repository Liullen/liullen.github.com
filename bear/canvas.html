<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Paint</title>
    <style>
    #container {
        position: relative;
    }
    
    #imageView {
        border: 1px solid #000;
    }
    </style>
</head>

<body>
    <form>
        <label>
            <input name="dialog" value="非常好!">
        </label>
    </form>
    <div id="container">
        <canvas id="imageView" width="256" height="256" />
    </div>
    <script>
    // Keep everything in anonymous function, called on window load.
    if (window.addEventListener) {
        window.addEventListener('load', function() {
                var canvas, context, img;

                // Initialization sequence.
                function init() {
                    // Find the canvas element.
                    canvas = document.getElementById('imageView');
                    img = document.createElement('img');
                    img.src = '1.png';
                    if (!canvas) {
                        alert('Error: I cannot find the canvas element!');
                        return;
                    }

                    if (!canvas.getContext) {
                        alert('Error: no canvas.getContext!');
                        return;
                    }

                    // Get the 2D canvas context.
                    context = canvas.getContext('2d');
                    if (!context) {
                        alert('Error: failed to getContext!');
                        return;
                    }

                    canvas.addEventListener('click', ev_mouseclick, false);

                    img.addEventListener("load", function() {
                        clearCanvas();
                        context.drawImage(img, 0, 0);
                    }, false);

                    // To enable drag and drop
                    canvas.addEventListener("dragover", function(evt) {    
                        evt.preventDefault();
                    }, false); 
                    // Handle dropped image file - only Firefox and Google Chrome
                    canvas.addEventListener("drop", function(evt) {    
                        var files = evt.dataTransfer.files;    
                        if (files.length > 0) {        
                            var file = files[0];        
                            if (typeof FileReader !== "undefined" && file.type.indexOf("image") != -1) {            
                                var reader = new FileReader();             // Note: addEventListener doesn't work in Google Chrome for this event
                                            
                                reader.onload = function(evt) {                
                                    img.src = evt.target.result;            
                                };            
                                reader.readAsDataURL(file);        
                            }    
                        }    
                        evt.preventDefault();
                    }, false);   
                }

                var clearCanvas = function() {                
                    context.clearRect(0, 0, canvas.width, canvas.height);            
                };
                var i = 0;
                function ev_mouseclick(ev) {
                    var x, y;

                    // Get the mouse position relative to the canvas element.
                    if (ev.layerX || ev.layerX == 0) { // Firefox
                        x = ev.layerX;
                        y = ev.layerY;
                    } else if (ev.offsetX || ev.offsetX == 0) { // Opera
                        x = ev.offsetX;
                        y = ev.offsetY;
                    }

                    var text = document.forms[0].dialog.value;

                    if (i == text.length) {
                        i=0;
                    }

                    context.font="26px Georgia";
                    context.fillText(text[i++], x, y);
                }
                init();
            },
            false);
    }
    </script>
</body>

</html>
